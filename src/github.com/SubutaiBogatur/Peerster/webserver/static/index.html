<!DOCTYPE html>
        {{/*I don't like frontend, I don't really want to do it beautifully, what is beautiful is backend, better have a look at it*/}}
<body>

<div id="frame">
    <div style="margin-bottom: 20px">
        <h3>
            this gossiper
        </h3>

        <div id="gossiper-name">
        </div>

        <div id="gossiper-id">
        </div>

        <input type="text" id="gossiper-text-input" placeholder="New gossiper name..."/>
        <button id="gossiper-name-button">
            Change name
        </button>
    </div>

    <div>
        <div style="float: left">
            <div id="peers">
                <h3>
                    known peers
                </h3>

                <ul id="peers-list">
                </ul>

                <input type="text" id="peer-input" placeholder="New peer ip:port ..."/>
                <button id="add-peer-button">
                    Add peer
                </button>
            </div>

            <div id="rumor-messages">
                <h3>
                    rumor messages
                </h3>

                <ul id="rumor-messages-list">
                </ul>

                <input type="text" id="rumor-message-input" placeholder="New message to gossip..."/>
                <button id="send-rumor-message-button">
                    Send message
                </button>
            </div>
        </div>

        <div style="float: left; margin-left: 20px">
            <div id="peers">
                <h3>
                    known origins
                </h3>

                <ul id="origins-list">
                    <li>
                        <input type="radio" name="origin" value="looser"> looser <br>
                    </li>
                    <li>
                        <input type="radio" name="origin" value="asdf"> asdf <br>
                    </li>
                </ul>
            </div>

        </div>
    </div>

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script>

    // init fields:
    document.getElementById("gossiper-name-button").onclick = changeGossiperNameOnClick;
    document.getElementById("add-peer-button").onclick = addNewPeerOnClick;
    document.getElementById("send-rumor-message-button").onclick = sendRumorMessageOnClick;

    updateAllFields();
    var timer = setInterval(updateAllFields, 1000 * 1); // update everything once in timeout

    function updateAllFields() {
        callGetGossiperName();
        callGetID();
        callGetPeers();
        callGetMessages();
    }

    function sendRumorMessageOnClick() {
        callSendRumorMessage();
        callGetMessages();
        callGetID();
    }

    function callGetMessages() {
        function gotMessages(msgs, status, dunno) {
            list = document.getElementById("rumor-messages-list");
            while (list.hasChildNodes()) {
                list.removeChild(list.firstChild)
            }
            var i;
            for (i = msgs.length - 1; i >= 0; i--) { // never messages higher
                // console.log(msgs);
                list.appendChild(document.createTextNode(msgs[i].OriginalName + " - " + msgs[i].ID + " - " + msgs[i].Text));
                list.appendChild(document.createElement("br"));
            }
        }

        jQuery.ajax({
            method: "GET",
            url: "/getMessages",
            success: gotMessages
        })
    }

    function callSendRumorMessage() {
        var msg = document.getElementById("rumor-message-input").value;
        jQuery.ajax({
            method: "POST",
            url: "/sendRumorMessage",
            data: msg
        });
        document.getElementById("rumor-message-input").value = "";
    }

    function addNewPeerOnClick() {
        callAddPeer();
        callGetPeers();
    }

    function callGetPeers() {
        function gotPeers(peers, status, dunno) {
            list = document.getElementById("peers-list")
            while (list.hasChildNodes()) {
                list.removeChild(list.firstChild)
            }
            var i;
            for (i = 0; i < peers.length; i++) {
                list.appendChild(document.createTextNode(peers[i].IP + ":" + peers[i].Port));
                list.appendChild(document.createElement("br"));
            }
        }

        jQuery.ajax({
            method: "GET",
            url: "/getPeers",
            success: gotPeers
        });
    }

    function callAddPeer() {
        var newPeer = document.getElementById("peer-input").value;
        jQuery.ajax({
            method: "POST",
            url: "/addPeer",
            data: newPeer
        });
        document.getElementById("peer-input").value = "";
    }

    function changeGossiperNameOnClick() {
        callSetGossiperName();
        callGetGossiperName();
        callGetID();
    }

    function callSetGossiperName() {
        var newName = document.getElementById("gossiper-text-input").value;
        jQuery.ajax({
            method: "POST",
            url: "/setGossiperName",
            data: newName
        });
        document.getElementById("gossiper-text-input").value = "";
    }

    function callGetGossiperName() {
        function gotNewName(name, status, dunno) {
            document.getElementById("gossiper-name").innerHTML = "name: " + name;
        }

        jQuery.ajax({
            method: "GET",
            url: "/getGossiperName",
            success: gotNewName
        });
    }

    function callGetID() {
        function gotID(id, status, dunno) {
            document.getElementById("gossiper-id").innerHTML = "id: " + id;
        }

        jQuery.ajax({
            method: "GET",
            url: "/getGossiperID",
            success: gotID
        });
    }


</script>
</body>
</html>
